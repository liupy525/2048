!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n(1),n(5);var i=n(7);r(i)},function(e,t){},,,,function(e,t){},,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),u=r(i),a=n(9),o=r(a),l=n(10),s=r(l),c=n(11),f=r(c),d=n(12),v=r(d);t["default"]=function(){var e,t,n,r=4,i=2,a=function(){o["default"].clearGameState(),s["default"].continueGame(),d()},l=function(){l=!0,s["default"].continueGame()},c=function(){return t||n&&!l},d=function(){var i=o["default"].getGameState();i?(v["default"].init(i.grid.size,i.grid.cells),e=i.score,t=i.over,n=i.won,l=i.keepPlaying):(v["default"].init(r),e=0,t=!1,n=!1,l=!1,m()),p()},h=function(){o["default"].rollbackGameState()&&d()},m=function(){for(var e=0;i>e;e++)y()},y=function(){if(v["default"].cellsAvailable()){var e=Math.random()<.9?2:4,t=new f["default"](v["default"].randomAvailableCell(),e);v["default"].insertSquare(t)}},p=function(){o["default"].getBestScore()<e&&o["default"].setBestScore(e),t?o["default"].clearGameState():o["default"].setGameState(x()),s["default"].update(v["default"],{score:e,over:t,won:n,bestScore:o["default"].getBestScore(),terminated:c()})},x=function(){return{grid:v["default"].serialize(),score:e,over:t,won:n,keepPlaying:l}},g=function(){v["default"].eachCell(function(e,t,n){n&&(n.mergedFrom=null,n.savePosition())})},b=function(e,t){v["default"].cells[e.x][e.y]=null,v["default"].cells[t.x][t.y]=e,e.updatePosition(t)},S=function(r){if(!c()){var i,u,a=w(r),o=C(a),l=!1;g(),o.x.forEach(function(t){o.y.forEach(function(r){if(i={x:t,y:r},u=v["default"].cellContent(i)){var o=_(i,a),s=v["default"].cellContent(o.next);if(s&&s.value===u.value&&!s.mergedFrom){var c=new f["default"](o.next,2*u.value);c.mergedFrom=[u,s],v["default"].insertSquare(c),v["default"].removeSquare(u),u.updatePosition(o.next),e+=c.value,2048===c.value&&(n=!0)}else b(u,o.farthest);q(i,u)||(l=!0)}})}),l&&(y(),I()||(t=!0),p())}},w=function(e){var t={0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}};return t[e]},C=function(e){for(var t={x:[],y:[]},n=0;r>n;n++)t.x.push(n),t.y.push(n);return 1===e.x&&(t.x=t.x.reverse()),1===e.y&&(t.y=t.y.reverse()),t},_=function(e,t){var n;do n=e,e={x:n.x+t.x,y:n.y+t.y};while(v["default"].withinBounds(e)&&v["default"].cellAvailable(e));return{farthest:n,next:e}},I=function(){return v["default"].cellsAvailable()||P()},P=function(){for(var e,t=0;r>t;t++)for(var n=0;r>n;n++)if(e=v["default"].cellContent({x:t,y:n}))for(var i=0;4>i;i++){var u=w(i),a={x:t+u.x,y:n+u.y},o=v["default"].cellContent(a);if(o&&o.value===e.value)return!0}return!1},q=function(e,t){return e.x===t.x&&e.y===t.y};return u["default"].on("move",S.bind(this)),u["default"].on("restart",a.bind(this)),u["default"].on("keepPlaying",l.bind(this)),u["default"].on("rollback",h.bind(this)),d(),{}}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e={},t=function(t,n){var r=e[t];r&&r.forEach(function(e){e(n)})},n=function(){var e={38:0,39:1,40:2,37:3};document.addEventListener("keydown",function(n){var i=n.altKey||n.ctrlKey||n.metaKey||n.shiftKey,u=e[n.which];i||void 0!==u&&(n.preventDefault(),t("move",u)),i||82!==n.which||r(n)}),a(".retry-button",r),a(".restart-button",r),a(".rollback-button",i),a(".keep-playing-button",u)},r=function(e){e.preventDefault(),t("restart")},i=function(e){e.preventDefault(),t("rollback")},u=function(e){e.preventDefault(),t("keepPlaying")},a=function(e,t){var n=document.querySelector(e);n.addEventListener("click",t)},o=function(t,n){e[t]||(e[t]=[]),e[t].push(n)};return n(),{on:o}}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e,t="bestScore",n="lastBestScore",r="gameState",i="lastGameState",u=function(){return a()?window.localStorage:{_data:{},setItem:function(e,t){return this._data[e]=String(t)},getItem:function(e){return this._data.hasOwnProperty(e)?this._data[e]:void 0},removeItem:function(e){return delete this._data[e]},clear:function(){return this._data={}}}},a=function(){var e="test",t=window.localStorage;try{return t.setItem(e,"1"),t.removeItem(e),!0}catch(n){return!1}},o=function(){return e.getItem(t)||0},l=function(r){var i=e.getItem(t);e.setItem(t,r),e.setItem(n,i)},s=function(){var t=e.getItem(r);return t?JSON.parse(t):null},c=function(t){var n=e.getItem(r);e.setItem(r,JSON.stringify(t)),e.setItem(i,n)},f=function(){e.removeItem(r)},d=function(){var u=e.getItem(i),a=e.getItem(n);return u?(e.removeItem(i),e.removeItem(n),e.setItem(r,u),e.setItem(t,a),!0):!1},e=u();return{getBestScore:o,setBestScore:l,getGameState:s,setGameState:c,clearGameState:f,rollbackGameState:d}}()},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function(){var e=document.querySelector(".square-container"),t=document.querySelector(".score-container"),n=document.querySelector(".best-container"),r=document.querySelector(".game-message"),i=0,u=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},a=function h(t){var n=document.createElement("div"),r=document.createElement("div"),i=t.previousPosition||{x:t.x,y:t.y},u=s(i),a=["square","square-"+t.value,u];t.value>2048&&a.push("square-super"),o(n,a),r.classList.add("square-inner"),r.textContent=t.value,t.previousPosition?window.requestAnimationFrame(function(){a[2]=s({x:t.x,y:t.y}),o(n,a)}):t.mergedFrom?(a.push("square-merged"),o(n,a),t.mergedFrom.forEach(function(e){h(e)})):(a.push("square-new"),o(n,a)),n.appendChild(r),e.appendChild(n)},o=function(e,t){e.setAttribute("class",t.join(" "))},l=function(e){return{x:e.x+1,y:e.y+1}},s=function(e){return e=l(e),"square-position-"+e.x+"-"+e.y},c=function(e){u(t);var n=e-i;if(i=e,t.textContent=i,n>0){var r=document.createElement("div");r.classList.add("score-addition"),r.textContent="+"+n,t.appendChild(r)}},f=function(e){var t=n,r=parseInt(t.textContent),i=e-r;if(t.textContent=e,i>0){var u=document.createElement("div");u.classList.add("score-addition"),u.textContent="+"+i,t.appendChild(u)}},d=function m(e){var t=e?"game-won":"game-over",m=e?"You win!":"Game over!";r.classList.add(t),r.getElementsByTagName("p")[0].textContent=m},v=function(){r.classList.remove("game-won"),r.classList.remove("game-over")};return{update:function(t,n){window.requestAnimationFrame(function(){u(e),t.cells.forEach(function(e){e.forEach(function(e){e&&a(e)})}),c(n.score),f(n.bestScore),n.terminated&&(n.over?d(!1):n.won&&d(!0))})},continueGame:function(){v()}}}()},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(t,r){n(this,e),this.x=t.x,this.y=t.y,this.value=r||2,this.previousPosition=null,this.mergedFrom=null}return r(e,[{key:"updatePosition",value:function(e){this.x=e.x,this.y=e.y}},{key:"savePosition",value:function(){this.previousPosition={x:this.x,y:this.y}}},{key:"serialize",value:function(){return{position:{x:this.x,y:this.y},value:this.value}}}]),e}();t["default"]=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),u=r(i);t["default"]=function(){var e=function(){for(var e=[],t=0;t<this.size;t++)for(var n=e[t]=[],r=0;r<this.size;r++)n.push(null);return e},t=function(e){for(var t=[],n=0;n<this.size;n++)for(var r=t[n]=[],i=0;i<this.size;i++){var a=e[n][i];r.push(a?new u["default"](a.position,a.value):null)}return t},n=function(){var e=[];return this.eachCell(function(t,n,r){r||e.push({x:t,y:n})}),e},r=function(e){return!!this.cellContent(e)};return{size:void 0,cells:void 0,init:function(n,r){this.size=n,this.cells=r?t.call(this,r):e.call(this)},randomAvailableCell:function(){var e=n.call(this);return e.length?e[Math.floor(Math.random()*e.length)]:void 0},eachCell:function(e){for(var t=0;t<this.size;t++)for(var n=0;n<this.size;n++)e.call(this,t,n,this.cells[t][n])},cellsAvailable:function(){return!!n.call(this).length},cellAvailable:function(e){return!r.call(this,e)},cellContent:function(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null},insertSquare:function(e){this.cells[e.x][e.y]=e},removeSquare:function(e){this.cells[e.x][e.y]=null},withinBounds:function(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size},serialize:function(){for(var e=[],t=0;t<this.size;t++)for(var n=e[t]=[],r=0;r<this.size;r++)n.push(this.cells[t][r]?this.cells[t][r].serialize():null);return{size:this.size,cells:e}}}}()}]);